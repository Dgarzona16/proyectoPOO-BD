using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Data;
using System.Data.SqlClient;

namespace proyecto_POO_BD.Properties
{

    public interface SQLReaderWriter
    {
        DataTable consult(string a, string b);

    }

    public class EventSQL : accessSQL, SQLReaderWriter
    {
        public EventSQL() : base()
        {
        }
        DataTable SQLReaderWriter.consult(string word, string colunm)
        {
            DataTable dt = new DataTable();

            using (var connection = getConnection())
            {
                connection.Open();
                using (var command = new SqlCommand())
                {
                    command.Connection = connection;

                    if (colunm == "Nombre de Evento")
                    {
                        command.CommandText = $"SELECT EVENTO.Id, EVENTO.Titulo, EVENTO.FechaHora_Inicio, EVENTO.FechaHora_Fin, EVENTO.CantidadParticipantes, AREA.Nombre AS 'Area' FROM EVENTO INNER JOIN AREA ON EVENTO.Id_Area = AREA.Id WHERE Titulo LIKE '{word}%'";
                    }
                    if (colunm == "Area")
                    {
                        command.CommandText = $"SELECT EVENTO.Id, EVENTO.Titulo, EVENTO.FechaHora_Inicio, EVENTO.FechaHora_Fin, EVENTO.CantidadParticipantes, AREA.Nombre AS 'Area' FROM EVENTO INNER JOIN AREA ON EVENTO.Id_Area = AREA.Id WHERE AREA.Nombre LIKE '{word}%'";
                    }

                    command.CommandType = CommandType.Text;
                    SqlDataAdapter adapter = new SqlDataAdapter();
                    adapter.SelectCommand = command;
                    adapter.Fill(dt);
                }
            }
            return dt;
        }
    }

    public class CollectionSQL : accessSQL, SQLReaderWriter
    {
        public CollectionSQL() : base()
        {
        }
        DataTable SQLReaderWriter.consult(string word, string colunm)
        {
            DataTable dt = new DataTable();

            using (var connection = getConnection())
            {
                connection.Open();
                using (var command = new SqlCommand())
                {
                    command.Connection = connection;

                    if (colunm == "Nombre de Coleccion")
                    {
                        command.CommandText = $"SELECT COLECCION.Id, COLECCION.Nombre, COLECCION.Tipo, COLECCION.Genero, AREA.Nombre AS 'Area' FROM COLECCION INNER JOIN AREA ON COLECCION.Id_Area = AREA.Id WHERE COLECCION.Nombre LIKE '{word}%'";
                    }
                    if (colunm == "Tipo de Coleccion")
                    {
                        command.CommandText = $"SELECT COLECCION.Id, COLECCION.Nombre, COLECCION.Tipo, COLECCION.Genero, AREA.Nombre AS 'Area' FROM COLECCION INNER JOIN AREA ON COLECCION.Id_Area = AREA.Id WHERE COLECCION.Tipo LIKE '{word}%'";
                    }
                    if (colunm == "Genero")
                    {
                        command.CommandText = $"SELECT COLECCION.Id, COLECCION.Nombre, COLECCION.Tipo, COLECCION.Genero, AREA.Nombre AS 'Area' FROM COLECCION INNER JOIN AREA ON COLECCION.Id_Area = AREA.Id WHERE COLECCION.Genero LIKE '{word}%'";
                    }

                    command.CommandType = CommandType.Text;
                    SqlDataAdapter adapter = new SqlDataAdapter();
                    adapter.SelectCommand = command;
                    adapter.Fill(dt);
                }
            }
            return dt;
        }
    }

    public class MaterialSQL : accessSQL, SQLReaderWriter
    {
        public MaterialSQL() : base()
        {
        }
        DataTable SQLReaderWriter.consult(string word, string colunm)
        {
            DataTable dt = new DataTable();

            using (var connection = getConnection())
            {
                connection.Open();
                using (var command = new SqlCommand())
                {
                    command.Connection = connection;

                    if (colunm == "Nombre del material")
                    {
                        command.CommandText = $"SELECT MATERIAL.Id, MATERIAL.Nombre, MATERIAL.Autor, MATERIAL.Idioma, MATERIAL.Editorial, COLECCION.Nombre AS 'Coleccion' FROM MATERIAL INNER JOIN AREA ON MATERIAL.Id_Coleccion = COLECCION.Id WHERE MATERIAL.Nombre LIKE '{word}%'";
                    }
                    if (colunm == "Autor")
                    {
                        command.CommandText = $"SELECT MATERIAL.Id, MATERIAL.Nombre, MATERIAL.Autor, MATERIAL.Idioma, MATERIAL.Editorial, COLECCION.Nombre AS 'Coleccion' FROM MATERIAL INNER JOIN AREA ON MATERIAL.Id_Coleccion = COLECCION.Id WHERE MATERIAL.Autor LIKE '{word}%'";
                    }
                    if (colunm == "Formato")
                    {
                        command.CommandText = $"SELECT MATERIAL.Id, MATERIAL.Nombre, MATERIAL.Autor, MATERIAL.Idioma, MATERIAL.Editorial, COLECCION.Nombre AS 'Coleccion' FROM MATERIAL INNER JOIN AREA ON MATERIAL.Id_Coleccion = COLECCION.Id INNER JOIN FORMATO ON MATERIAL.Id_Formato = FORMATO.Id WHERE FORMATO.Tipo LIKE '{word}%'";
                    }

                    command.CommandType = CommandType.Text;
                    SqlDataAdapter adapter = new SqlDataAdapter();
                    adapter.SelectCommand = command;
                    adapter.Fill(dt);
                }
            }
            return dt;
        }
    }
}

    
